openapi: 3.0.3
info:
  title: OptHub REST API
  description: |-
    OptHub Public REST API.
  termsOfService: https://example.com/todo/opthub-api-term-of-service
  contact:
    email: dev@opthub.ai
  license:
    name: MIT
    url: https://opensource.org/license/mit/
  version: 0.2.0

servers:
  - url: https://example.com/todo/opthub-api-endpoint

tags:
  - name: solution
    description: Operations about solution.
  - name: trial
    description: Operations about trial.

paths:
  /matches/{matchUuid}/solutions:
    post:
      tags:
        - solution
      summary: Create solution
      operationId: createSolution
      parameters:
        - name: matchUuid
          in: path
          description: Match UUID
          required: true
          schema:
            $ref: '#/components/schemas/MatchUuid'
          example: 5d7fc778-3e59-4128-a797-2e423c0aa461
      requestBody:
        content:
          application/json:
            schema:
              description: Solution space variable
              type: array
              items:
                type: number
                format: double
              example: [1.234, -5.678, 9.1011]
      responses:
        '200':
          description: Information of the created solution
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateSolutionResponse'
        '404':
          description: Match not found
      security:
        - ApiKeyAuth: []

  /matches/{matchUuid}/trials/{trialNo}:
    get:
      tags:
        - trial
      summary: |-
        Retrieve a specific trial related to the solution submitted by the participant themselves.
      operationId: getMatchTrial
      parameters:
        - name: matchUuid
          in: path
          description: Match UUID
          required: true
          schema:
            $ref: '#/components/schemas/MatchUuid'
          example: 5d7fc778-3e59-4128-a797-2e423c0aa461
        - name: trialNo
          in: path
          description: Trial number
          required: true
          schema:
            type: integer
            format: int32
            example: 4
          example: 4
      responses:
        '200':
          description: Information of the trial
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchTrial'
        '404':
          description: The trial specified in the query was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchTrialNotFound'
      security:
        - ApiKeyAuth: []

  /matches/{matchUuid}/trials/{trialNo}/solution:
    get:
      tags:
        - trial
        - solution
      summary: Retrieve a solution submitted by the participant themselves.
      operationId: getSolution
      parameters:
        - name: matchUuid
          in: path
          description: Match UUID
          required: true
          schema:
            $ref: '#/components/schemas/MatchUuid'
          example: 5d7fc778-3e59-4128-a797-2e423c0aa461
        - name: trialNo
          in: path
          description: Trial number
          required: true
          schema:
            type: integer
            format: int32
            example: 4
          example: 4
      responses:
        '200':
          description: Information of the Solution
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Solution'
        '404':
          description: The trial specified in the query was not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MatchTrialNotFound'
      security:
        - ApiKeyAuth: []


components:
  schemas:
    CreateSolutionResponse:
      description: Information of the created solution
      type: object
      properties:
        trialNo:
          type: integer
          format: int32
          description: Trial number
          example: 4
      required:
        - trialNo

    MatchTrial:
      description: Match Trial information
      type: object
      properties:
        matchTrialStatus:
          description: Status of the Trial
          $ref: '#/components/schemas/MatchTrialStatus'
        evaluation:
          description: Evaluation results
          $ref: '#/components/schemas/MatchTrialEvaluation'
        score:
          description: Results of Score calculation
          $ref: '#/components/schemas/MatchTrialScore'
      required:
        - matchTrialStatus

    MatchTrialStatus:
      description: Status of the Trial
      type: string
      enum:
        - Evaluating
        - Scoring
        - Success
        - EvaluatorFailed
        - ScorerFailed

    Solution:
      description: Solution information
      type: object
      properties:
        variable:
          description: Solution space variable
          type: array
          items:
            type: number
            format: double
          example: [1.234, -5.678, 9.1011]
        createdAt:
          description: Creation date and time
          type: string
          format: date-time
          example: 2024-08-06T10:11:45.789Z
        createdByParticipant:
          description: UUID of the participant who created it
          $ref: '#/components/schemas/ParticipantUuid'
        createdByUser:
          description: UUID of the user who created it
          $ref: '#/components/schemas/UserUuid'
      required:
        - variable
        - createdAt

    MatchTrialEvaluation:
      description: Evaluation results
      type: object
      properties:
        objective:
          description: The value of the objective function
          type: array
          items:
            type: number
            format: double
          example: [12.1314]
        constraint:
          description: The value of the constraint condition
          type: object
        feasible:
          description: Whether it is a feasible solution
          type: boolean
        extraInfo:
          description: Auxiliary information for evaluation
          type: object
        startedAt:
          description: Evaluation start date and time
          type: string
          format: date-time
          example: 2024-08-29T10:12:58.123Z
        finishedAt:
          description: Evaluation end date and time
          type: string
          format: date-time
          example: 2024-08-29T10:34:01.592Z
        error:
          description: Evaluation error information
          type: string
        status:
          description: Evaluation status
          $ref: '#/components/schemas/RunnerStatus'
      required:
        - status

    RunnerStatus:
      description: Status of the Trial
      type: string
      enum:
        - Success
        - Failed

    MatchTrialScore:
      description: Results of Score calculation
      type: object
      properties:
        value:
          description: The value of the Score
          type: number
          format: double
          example: 15.1617
        startedAt:
          description: Score calculation start date and time
          type: string
          format: date-time
          example: 2024-08-29T10:12:59.123Z
        finishedAt:
          description: Score calculation end date and time
          type: string
          format: date-time
          example: 2024-08-29T10:34:02.592Z
        error:
          description: Score calculation error information
          type: string
        status:
          description: Score calculation status
          $ref: '#/components/schemas/RunnerStatus'

    MatchTrialNotFound:
      description: The reason why the trial was not found.
      type: string
      enum:
        - InvalidMatchUuid
        - NoSuchTrialNo

    MatchUuid:
      description: Match UUID
      type: string
      format: uuid
      example: 5d7fc778-3e59-4128-a797-2e423c0aa461

    ParticipantUuid:
      description: Participant UUID
      type: string
      format: uuid
      example: 912f548d-2bbe-48ab-90ce-e96dae38377d

    UserUuid:
      description: User UUID
      type: string
      format: uuid
      example: 1e892e70-47ba-4c8e-8563-6aea9019e334

  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: x-api-key
